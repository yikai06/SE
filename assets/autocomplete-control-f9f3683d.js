import{E as oe,r as A,a as se,j as ne,K as u,O as c,a5 as ae,a1 as V,R as I,X as C,W as L,P as p,H as O,a6 as R,U as h,Q as N,V as re,a3 as ie,v as F,n as $}from"./forms-5e524d78.js";import{I as K,a as ue}from"./endpoints-461b1c36.js";import{d as ce,E as de}from"./vue-libs-5c981799.js";import"./ff-button.vue_vue_type_style_index_0_scoped_0a22213a_lang-033e91f9.js";const pe=["for"],me={key:0,class:"text-danger ms-2"},fe={class:"form-control-wrapper"},Ie=["onClick"],he=["id","name","placeholder","autocomplete","value","readonly","disabled"],ge=["for"],Ve={class:"list-group-autocomplete-wrapper"},ye={class:"list-group-autocomplete list-group list-group-flush mb-0"},be=["aria-selected","onClick"],Fe=["innerHTML"],ve={key:0,class:"list-group-item fs-14p text-gray-900 px-16p py-12p"},xe={key:1,class:"error-message caption text-danger mb-0"},we=oe({__name:"autocomplete-control",props:{id:{},label:{},name:{},placeholder:{default:"Please select"},items:{default:()=>[]},itemText:{},itemValue:{},returnObject:{type:Boolean},noDataText:{default:"No data available"},cacheItems:{type:Boolean,default:!0},chips:{type:Boolean},noFilter:{type:Boolean},clearable:{type:Boolean},disabled:{type:Boolean},autocomplete:{},multiple:{type:Boolean},floating:{type:Boolean},errorMessage:{},mandatory:{type:Boolean},modelValue:{},asSelect:{type:Boolean}},emits:["update:modelValue","search","clear","change"],setup(P,{emit:j}){const l=P,r=j,H=ce("(pointer:coarse)"),m=A(),v=A(null),t=se({isDropdownActive:!1,selectionFocusIndex:-1,listItemFocusIndex:-1,inputValue:"",cachedItems:l.cacheItems?l.items:[]}),g=A([]),y=e=>e?typeof e=="string"?e:l.itemText?e[l.itemText]:"":"",z=e=>{const s=o=>t.inputValue?o.replace(new RegExp(M(t.inputValue),"gi"),"<mark>$&</mark>"):o;if(!e)return"";if(typeof e=="string")return s(e);if(!l.itemText)return"";const n=e[l.itemText];return s(n)},i=e=>e?typeof e=="string"?e:e[l.itemValue]:"",D=ne(()=>{var n;const e=l.modelValue;if(!e)return[];if(!l.multiple&&typeof e=="string"){const o=(n=l.items)==null?void 0:n.find(a=>i(a)===i(e));return o&&B([o]),[o||""]}if(!Array.isArray(e))return[];const s=e.map(o=>[...l.items,...t.cachedItems].find(a=>i(a)===o));return s.length>0&&B(s),s}),B=e=>{if(l.cacheItems)for(let s of e){const n=i(s);t.cachedItems.findIndex(a=>i(a)===n)===-1&&t.cachedItems.push(s)}},U=(e=t.listItemFocusIndex+1)=>e===d().length?0:e,Q=(e=t.listItemFocusIndex-1)=>e<0?d().length-1:e,W=(e=t.selectionFocusIndex-1)=>l.multiple&&Array.isArray(l.modelValue)?e<0?l.modelValue.length-1:e:e===-1?0:-1,X=(e=t.selectionFocusIndex+1)=>l.multiple&&Array.isArray(l.modelValue)?e===l.modelValue.length?0:e:e===-1?0:-1,d=()=>l.noFilter?l.items:l.items.filter(e=>new RegExp(M(t.inputValue),"gi").test(y(e)??"")),_=()=>{if(l.multiple){if(Array.isArray(l.modelValue)&&l.modelValue.length>0)return" "}else if(l.modelValue)return" ";return l.placeholder},M=e=>e&&e.replace(/[\\^$*+?.()|{}[]/g,"\\$&"),T=e=>l.multiple?Array.isArray(l.modelValue)&&l.modelValue.includes(i(e)):i(e)===l.modelValue,S=()=>{t.inputValue&&(t.inputValue="",r("search",t.inputValue))},q=()=>{t.listItemFocusIndex=-1,t.selectionFocusIndex=-1,S()},G=()=>{let e=t.listItemFocusIndex!==-1?t.listItemFocusIndex:0;const s=l.modelValue&&d().findIndex(n=>l.multiple&&Array.isArray(l.modelValue)?l.modelValue.find(o=>o===i(n)):i(n)===l.modelValue);s&&s!==-1&&(e=s),t.listItemFocusIndex=e,g.value[e]&&g.value[e].scrollIntoView({block:"nearest"})},x=e=>{const s=l.returnObject?e:i(e);if(!l.multiple){r("update:modelValue",s),r("change");return}const n=l.modelValue;let o=Array.isArray(n)?n:[];if(!T(e))o.push(s);else{const a=o.findIndex(f=>f===s);a!==-1&&o.splice(a,1)}o=o.filter((a,f,b)=>b.indexOf(a)===f),r("update:modelValue",o),r("change")},J=(e,s=!0)=>{const n=l.returnObject?e:i(e);x(n),t.inputValue="";const o=d().indexOf(e);o!==-1&&(t.listItemFocusIndex=o),$(()=>{var a;s&&((a=m.value)==null||a.hide(),t.listItemFocusIndex=-1),t.selectionFocusIndex=-1})},Y=e=>{var s,n,o,a,f,b;if(l.items)switch(e.key){case"Enter":e.preventDefault();const E=d()[t.listItemFocusIndex];E&&(x(E),S(),(s=m.value)==null||s.hide());return;case"ArrowDown":if(e.preventDefault(),!t.isDropdownActive){(n=m.value)==null||n.show();return}t.selectionFocusIndex=-1,t.listItemFocusIndex=U(),(o=g.value[t.listItemFocusIndex])==null||o.scrollIntoView({block:"nearest",behavior:"smooth"});break;case"ArrowUp":if(e.preventDefault(),!t.isDropdownActive){(a=m.value)==null||a.show();return}t.selectionFocusIndex=-1,t.listItemFocusIndex=Q(),(f=g.value[t.listItemFocusIndex])==null||f.scrollIntoView({block:"nearest",behavior:"smooth"});break;case"ArrowLeft":e.preventDefault(),t.selectionFocusIndex=W();break;case"ArrowRight":e.preventDefault(),t.selectionFocusIndex=X();break;case"Backspace":if($(()=>r("search",t.inputValue)),!t.inputValue.trim()&&!l.asSelect)if(e.preventDefault(),l.multiple&&Array.isArray(l.modelValue))if(t.selectionFocusIndex===-1)t.selectionFocusIndex=l.modelValue.length-1;else{const k=[...l.modelValue];k.splice(t.selectionFocusIndex,1),t.selectionFocusIndex=Math.min(t.selectionFocusIndex,k.length-1),r("update:modelValue",k),r("change")}else t.inputValue.trim()||(r("update:modelValue",""),r("change"));t.inputValue=e.target.value;break;case"Escape":t.selectionFocusIndex=-1,t.listItemFocusIndex=-1,(b=m.value)==null||b.hide();break;default:l.asSelect||(t.inputValue=e.target.value,r("search",t.inputValue),t.selectionFocusIndex=-1,t.listItemFocusIndex=-1,e.preventDefault());break}},Z=()=>v.value&&v.value.focus(),w=e=>e.preventDefault(),ee=()=>{l.multiple?r("update:modelValue",[]):r("update:modelValue",""),r("change"),r("clear")},te=()=>!l.clearable||!l.modelValue?!1:l.multiple?l.modelValue.length>0:!!l.modelValue,le=e=>{const n=e.target.value,o=d().find(a=>y(a)===n);o&&x(o)};return(e,s)=>(u(),c("div",{class:h(["field-autocomplete",!!e.errorMessage&&"is-invalid"])},[e.label&&!e.floating?(u(),c("label",{key:0,for:e.id,class:"form-label"},[ae(V(e.label)+" ",1),e.mandatory?(u(),c("span",me,"*")):I("",!0)],8,pe)):I("",!0),C(F(de),{ref_key:"dropdownRef",ref:m,"popper-class":"ff-autocomplete-dropdown",placement:"bottom-start","auto-size":"","no-auto-focus":"","onUpdate:shown":s[1]||(s[1]=n=>t.isDropdownActive=n),onApplyShow:G},{popper:L(()=>[p("div",Ve,[p("ul",ye,[(u(!0),c(O,null,R(d(),(n,o)=>(u(),c("li",{ref_for:!0,ref_key:"optionItems",ref:g,class:h(["list-group-item fs-14p px-16p py-12p border-0",T(n)&&"is-selected",t.listItemFocusIndex===o&&"is-focused"]),"aria-selected":i(n)===e.modelValue?"true":"false",onClick:a=>J(n,!e.multiple),onMousedown:w},[p("span",{class:"list-item-text",innerHTML:z(n)},null,8,Fe)],42,be))),256)),d().length===0?(u(),c("li",ve,V(e.noDataText),1)):I("",!0)])])]),default:L(()=>[p("div",fe,[p("div",{onClick:Z,class:h(["field-selection",{"form-floating mb-0":e.floating,"px-4 py-3":!e.floating,"field-selection-chips":e.chips,"is-disabled":e.disabled,"is-invalid":e.errorMessage}])},[N(e.$slots,"field-selection",{fieldValue:D.value,focusIndex:t.selectionFocusIndex,onMouseDown:w,getItemText:y,chips:e.chips},()=>[(u(!0),c(O,null,R(D.value,(n,o)=>(u(),c("span",{class:h(["field-selection-item",{"is-focused":t.selectionFocusIndex===o,"field-selection-item-chip":e.chips}]),onClick:a=>t.selectionFocusIndex=o,onMousedown:w},[p("span",null,V(y(n)),1)],42,Ie))),256))]),p("input",{ref_key:"inputRef",ref:v,id:e.id,name:e.name,placeholder:_(),class:h(["form-control",e.asSelect&&"caret-white"]),type:"search",autocomplete:e.autocomplete,value:t.inputValue,onKeyup:Y,onKeydown:s[0]||(s[0]=re(ie(()=>{},["prevent"]),["enter"])),onBlur:q,onChange:le,readonly:e.asSelect&&F(H),disabled:e.disabled},null,42,he),e.label&&e.floating?(u(),c("label",{key:0,for:e.id,class:h(["form-label",(Array.isArray(e.modelValue)&&e.modelValue.length>0||!Array.isArray(e.modelValue)&&e.modelValue)&&"floats"])},V(e.label),11,ge)):I("",!0),N(e.$slots,"field-selection-end"),C(F(K),{symbol:"chevron-down",class:"icon-toggle icon-14p position-absolute end-0 top-50 translate-middle-y"})],2),te()?(u(),c("button",{key:0,onClick:ee,class:"btn btn-overlay-dark btn-clear p-1 rounded-circle",title:"Clear input",type:"button",tabindex:"-1"},[C(F(K),{symbol:"x"})])):I("",!0)])]),_:3},512),e.errorMessage?(u(),c("p",xe,V(e.errorMessage),1)):I("",!0)],2))}}),Me=ue(we,[["__file","autocomplete-control.vue"]]);export{Me as A};
