import{d as p}from"./pinia-20a6ceed.js";import{e as a}from"./use-geolocation-9c96d09d.js";import"./forms-697c0855.js";import{a as r}from"./general-libs-bb1bbc34.js";import{g as y,i as I}from"./i18n-fb5925bd.js";import"./axios-427c969f.js";import{e as l}from"./endpoints-03992eb2.js";const m=p("joinOnline",{state:()=>({tokenResponse:null,countryId:"",countryName:"",countryIntlDialCode:"",isTranslationsLoaded:!1,minAgeInYears:18}),getters:{token:e=>{var s;return((s=e.tokenResponse)==null?void 0:s.token)??""}},actions:{async loadAndInstallTranslations(){if(!this.countryId)return;this.isTranslationsLoaded=!1;const e=y(),s=r.get(`${l.JOIN_ONLINE}/${e}/json`,{params:{countryId:this.countryId,lang:e}}),t=await a(s);try{const{mergeLocaleMessage:n}=I.global;n(e,t.data.Data),this.isTranslationsLoaded=!0}catch(n){console.error("An error has occurred when trying to parse translations",n)}}}}),h=p("joinOnline-membership",{state:()=>{const e=sessionStorage.getItem("ff.jol.utm");return{profile:{firstName:"",lastName:"",mobilePhone:"",email:"",mobilePhoneRegionCode:"",isAgreeTerms:!1,isAgreeWithHealthStatement:!1,isHappyToBeContacted:!1,isAllowContactByThirdParty:!1,line1:"",line2:"",country:"",city:"",state:"",postCode:"",genderCode:"",dateOfBirth:"",nationalId:"",otherNationalId:""},planConfig:{reciprocalAccessTypeKey:"single",clubId:void 0,clusterId:void 0,reciprocalAccessCode:void 0,membershipLength:void 0,startDate:void 0,addonClassIds:[],addonIds:[],promotionCode:void 0,memberReferrerCode:void 0,countryId:"{147BDBAD-233B-464E-BD5F-072CAE73CC0F}",sessionId:void 0},membershipPreviewCount:0,membershipPreview:null,membershipResponse:null,messageKeys:[],utm:e?JSON.parse(e):null,leadId:"",isUpdatingMembershipPreview:!1}},getters:{countryId:()=>m().countryId,lastMessageKey:e=>e.messageKeys[e.messageKeys.length-1]},actions:{setUtmParams(){if(this.utm)return;const e=new URL(window.location.href);this.$patch({utm:{campaign:e.searchParams.get("utm_campaign")??"",source:e.searchParams.get("utm_source")??"",content:e.searchParams.get("utm_content")??"",medium:e.searchParams.get("utm_medium")??"",term:e.searchParams.get("utm_term")??""}})},async loadMembershipPlanPreview(){const e=r.post(`${l.JOIN_ONLINE}/payment/preview`,this.planConfig),s=await a(e);this.membershipPreview=s.data.data;const t=this.membershipPreview.addonClasses.map(u=>{if(u.isPreselected||u.isFeature)return u.id}),n=this.membershipPreview.addons.map(u=>u.id),i=this.messageKeys,d=this.membershipPreviewCount===0,c=this.membershipPreview.messages[0];d||i.push(c?this.membershipPreview.messages[0]:"");const o=this.membershipPreview.promotions[0];this.planConfig.promotionCode&&!o.isSuccess&&(this.planConfig.promotionCode=""),this.$patch({planConfig:{addonClassIds:t,addonIds:n},messageKeys:i,membershipPreviewCount:this.membershipPreviewCount+1})},async createOrUpdateLead(){var s,t,n,i,d;const e={FirstName:this.profile.firstName,LastName:this.profile.lastName,DOB:this.profile.dateOfBirth,Email:this.profile.email,Mobile:this.profile.mobilePhoneRegionCode+this.profile.mobilePhone,PreferredClub:this.planConfig.clubId,TnC:this.profile.isAgreeTerms,HealthDeclaration:this.profile.isAgreeWithHealthStatement,MarketingConsent:this.profile.isAllowContactByThirdParty&&this.profile.isHappyToBeContacted,UtmCampaign:(s=this.utm)==null?void 0:s.campaign,UtmSource:(t=this.utm)==null?void 0:t.source,UtmTerm:(n=this.utm)==null?void 0:n.term,UtmContent:(i=this.utm)==null?void 0:i.content,UtmMedium:(d=this.utm)==null?void 0:d.medium,Address1:this.profile.line1,Address2:this.profile.line2,PostalCode:this.profile.postCode,City:this.profile.city,Country:this.profile.country,SessionId:this.planConfig.sessionId};if(this.leadId){const c=r.put(`${l.JOIN_ONLINE}/leads`,e,{params:{id:this.leadId}});await a(c)}else{const c=r.post(`${l.JOIN_ONLINE}/leads`,e,{params:{countryId:this.countryId}}),o=await a(c);this.leadId=o.data.data}},async createMembership(){const s=m().countryIntlDialCode,t=r.post(`${l.JOIN_ONLINE}/members`,{...this.planConfig,...this.profile,mobilePhoneRegionCode:s,line2:this.profile.line2?this.profile.line2:null,city:this.profile.city?this.profile.city:null,state:this.profile.state?this.profile.state:null}),n=await a(t);if(this.membershipResponse=n.data.data,!n.data.isSuccess)throw n.data},async completeLead(){if(!this.leadId)return;const e=r.put(`${l.JOIN_ONLINE}/leads/complete`,null,{params:{id:this.leadId}});await a(e)}}}),f=p("joinOnline-websales",{state:()=>({websales:null,initialReciprocalAccessTypeKey:void 0,initialPlanConfig:void 0}),getters:{clubId:()=>h().planConfig.clubId??-1,countryId:()=>m().countryId??"",planOptions:e=>{var s;return(s=e.websales)==null?void 0:s.basicPlan.options},reciprocalAccessLevels(){return this.planOptions?[...this.planOptions.reciprocalAccessLevel.singleAccessLevels,...this.planOptions.reciprocalAccessLevel.dualAccessLevels]:[]},reciprocalAccessLevelTypes:e=>{if(!e.websales)return[];const s=[],{reciprocalAccessLevel:t}=e.websales.basicPlan.options;return t.singleAccessLevels.length>0&&s.push({key:"single",translation:"join_online.membership.access_level.selection.single",accessLevels:t.singleAccessLevels}),t.dualAccessLevels.length>0&&s.push({key:"dual",translation:"join_online.membership.access_level.selection.dual",accessLevels:t.dualAccessLevels}),s},getAccessLevelAccessLevelType(){return e=>{if(this.planOptions){if(this.planOptions.reciprocalAccessLevel.singleAccessLevels.find(s=>s.code===e.code))return"single";if(this.planOptions.reciprocalAccessLevel.dualAccessLevels.find(s=>s.code===e.code))return"dual"}}},commitmentLengths(){var e;return((e=this.planOptions)==null?void 0:e.commitmentLength.lengths)??[]},allAddons(){var e,s;return[...((e=this.planOptions)==null?void 0:e.addons.ptAddons)??[],...((s=this.planOptions)==null?void 0:s.addons.normalAddons)??[]]}},actions:{async loadClubPlan(){var d,c;const e=r.get(`${l.JOIN_ONLINE}/${this.clubId}/plan`,{params:{countryId:this.countryId}}),s=await a(e);this.websales=s.data.data;const n=this.websales.basicPlan.options.addonClass.classes.filter(o=>o.isPreSelected||o.isFeature),i=this.reciprocalAccessLevels.find(o=>o.isPreSelected);this.initialReciprocalAccessTypeKey=i?this.getAccessLevelAccessLevelType(i):"single",this.initialPlanConfig={clubId:this.clubId.toString(),addonClassIds:n==null?void 0:n.map(o=>o.id),addonIds:[],clusterId:(i==null?void 0:i.clusterId.toString())??"",countryId:this.countryId,memberReferrerCode:"",promotionCode:"",membershipLength:((d=this.commitmentLengths.find(o=>o.isPreSelected))==null?void 0:d.duration)??-1,reciprocalAccessCode:(i==null?void 0:i.code)??"",sessionId:((c=this.websales)==null?void 0:c.sessionId)??"",startDate:new Date().toISOString()}}}}),P=p("joinOnline-clubs",{state:()=>({clubsResponse:null}),getters:{countryId:()=>m().countryId,clubs:e=>{var s;return((s=e.clubsResponse)==null?void 0:s.clubs)??[]}},actions:{async getClubs(){if(!this.countryId)return;const e=r.get(`${l.JOIN_ONLINE}/clubs/${this.countryId}`),s=await a(e);this.clubsResponse=s.data.data}}}),N=p("joinOnline-config",{state:()=>({config:[]}),getters:{countryId:()=>m().countryId,configByKey:e=>s=>{var t;return(t=e.config.find(n=>n.key===s))==null?void 0:t.value},currencyCode(){return this.configByKey("Jol.Adyen.CurrencyCode")},dobConfig(){const e=this.configByKey("Jol.Member.DateOfBirth.Format");return e?e.replace("mm","MM"):""}},actions:{async loadJolConfig(){if(!this.countryId)return;const e=r.get(`${l.JOIN_ONLINE}/configuration`,{params:{countryId:this.countryId}}),s=await a(e);this.config=s.data.data.data}}}),A=p("joinOnline-payment",{state:()=>({adyenClientKey:"",adyenEnvironment:null,adyenAllowedPaymentMethodTypes:[],paymentMethodsResponse:null,initialPaymentResponse:null,verifyPaymentResponseDatetime:null,verifyPaymentResponse:null}),getters:{countryId:()=>m().countryId,sessionId:()=>{var e;return(e=f().websales)==null?void 0:e.sessionId},membershipNumber:()=>{var e;return(e=h().membershipResponse)==null?void 0:e.membershipNumber}},actions:{async getAdyenPaymentMethodsResponse(){if(!this.countryId||!this.sessionId||!this.membershipNumber)return;const e=r.post(`${l.JOIN_ONLINE}/payment-methods`,{countryId:this.countryId,sessionId:this.sessionId}),s=await a(e);this.paymentMethodsResponse={paymentMethods:s.data.data.paymentMethods.filter(t=>this.adyenAllowedPaymentMethodTypes.includes(t.type))}},async initialPayment(e){if(!this.countryId||!this.sessionId)return;const s=r.post(`${l.JOIN_ONLINE}/initial-payment`,{...e.data,countryId:this.countryId,sessionId:this.sessionId,currentUrl:window.location.href}),t=await a(s);this.initialPaymentResponse=t.data.data},async verifyPayment(e){if(!this.countryId||!this.sessionId)return;const s=r.post(`${l.JOIN_ONLINE}/verification`,{...e.data,countryId:this.countryId,sessionId:this.sessionId,currentUrl:window.location.href}),t=await a(s);this.verifyPaymentResponseDatetime=new Date().toISOString(),this.verifyPaymentResponse=t.data.data}}});export{f as a,N as b,h as c,A as d,m as e,P as u};
